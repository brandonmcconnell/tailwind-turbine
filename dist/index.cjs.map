{"version":3,"file":"index.cjs","sources":["../index.ts"],"sourcesContent":["import type { Config } from 'tailwindcss';\nimport type { ResolvableTo } from 'tailwindcss/types/config.d.ts';\nimport tailwindPlugin from 'tailwindcss/plugin.js';\n\ntype PossiblyInvoked<T extends (...args: any[]) => any> = T | ReturnType<T>;\n\n// Plugin Types\ntype TailwindPluginBase = typeof tailwindPlugin;\ntype TailwindPlugin = ReturnType<TailwindPluginBase> | PossiblyInvoked<ReturnType<TailwindPluginBase['withOptions']>>;\ntype TurbinePluginBase = {\n  transform?: (config: NormalizedConfig) => NormalizedConfig;\n  plugins?: TailwindPlugin[];\n};\nexport type TurbinePlugin = TurbinePluginBase | ((...params: any[]) => TurbinePluginBase);\ntype Plugin = TurbinePlugin | TailwindPlugin;\n\n// Tailwind Plugin Type Guard\nfunction hasTailwindHandler(plugin: Plugin) {\n  return 'handler' in plugin && typeof plugin.handler === 'function';\n}\nfunction isTailwindPlugin(plugin: Plugin): plugin is TailwindPlugin {\n  const p = typeof plugin === 'function' ? plugin({}) : plugin;\n  return p && hasTailwindHandler(p);\n}\n\n// Turbine Plugin Type Guard\nfunction hasTurbineTransform(plugin: Plugin) {\n  return 'transform' in plugin && typeof plugin.transform === 'function';\n}\nfunction hasTurbinePlugins(plugin: Plugin) {\n  return 'plugins' in plugin && Array.isArray(plugin.plugins) && plugin.plugins.every(isTailwindPlugin);\n}\nfunction isTurbinePlugin(plugin: Plugin): plugin is TurbinePlugin {\n  const p = typeof plugin === 'function' ? plugin({}) : plugin;\n  return p && (hasTurbineTransform(p) || hasTurbinePlugins(p));\n}\n\ntype NonNullableTheme = NonNullable<Config['theme']>;\ninterface NormalizedTheme extends NonNullableTheme {\n  // Responsiveness\n  supports: NonNullable<NonNullableTheme['supports']>;\n  data: NonNullable<NonNullableTheme['data']>;\n  // Reusable base configs\n  colors: NonNullable<NonNullableTheme['colors']>;\n  spacing: NonNullable<NonNullableTheme['spacing']>;\n  // Components\n  container: NonNullable<NonNullableTheme['container']>;\n}\n\ninterface NormalizedThemeWithExtend extends NormalizedTheme {\n  extend: NormalizedTheme;\n}\n\ninterface NormalizedConfig extends Config {\n  content: NonNullable<Config['content']>;\n  safelist: NonNullable<Config['safelist']>;\n  blocklist: NonNullable<Config['blocklist']>;\n  presets: NonNullable<Config['presets']>;\n  theme: NormalizedThemeWithExtend;\n  plugins: NonNullable<Config['plugins']>;\n}\n\nconst createNormalizedThemeObject = (): NormalizedTheme => ({\n  supports: {},\n  data: {},\n  colors: {},\n  spacing: {},\n  container: {},\n});\n\nconst normalizeConfig = (config: Partial<Config> | undefined = {}): NormalizedConfig => {\n  if (\n    !config.content ||\n    (Array.isArray(config.content) && config.content.length === 0) ||\n    (!Array.isArray(config.content) && config.content.files.length === 0)\n  ) {\n    console.warn(\n      'Empty `content` or `content.files` value found in `config`. This may yield unexpected results, as your project files may not be scanned by Tailwind CSS.'\n    );\n  }\n  config.content = {\n    files: Array.isArray(config.content) ? config.content : [],\n    ...(config.content && !Array.isArray(config.content) ? config.content : {}),\n  } satisfies NormalizedConfig['content'];\n  config.safelist ??= [] satisfies NormalizedConfig['safelist'];\n  config.blocklist ??= [] satisfies NormalizedConfig['blocklist'];\n  config.presets ??= [] satisfies NormalizedConfig['presets'];\n  config.theme = {\n    ...createNormalizedThemeObject(),\n    ...(config.theme ?? {}),\n    extend: {\n      ...createNormalizedThemeObject(),\n      ...(config.theme?.extend ?? {}),\n    } satisfies NormalizedTheme,\n  } satisfies NormalizedThemeWithExtend;\n  config.plugins ??= [] satisfies NormalizedConfig['plugins'];\n  return config as NormalizedConfig;\n};\n\n// Turbine Plugin Builder\nexport const build = ({\n  config: CONFIG_RAW,\n  plugins,\n  // reporting, // Coming soon ðŸ‘€\n}: {\n  config: Partial<Config>;\n  plugins: Plugin[];\n  // reporting?: boolean;\n}) => {\n  let i = 0;\n  let config = normalizeConfig(CONFIG_RAW);\n  for (const plugin of plugins) {\n    if (isTailwindPlugin(plugin)) {\n      config.plugins.push(plugin);\n    } else if (isTurbinePlugin(plugin)) {\n      const { transform, plugins } = typeof plugin === 'function' ? plugin() : plugin;\n      if (transform) {\n        config = transform(config);\n      }\n      if (plugins) {\n        config.plugins.push(\n          ...plugins.filter((plugin, j) => {\n            if (isTailwindPlugin(plugin)) return true;\n            console.warn(\n              `Invalid Tailwind CSS plugin found at position ${j} in Turbine plugin at position ${i}, skipping.`\n            );\n            return false;\n          })\n        );\n      }\n    } else {\n      throw new Error(`Invalid Turbine plugin at position ${i}, did not match Tailwind CSS or Turbine plugin.`);\n    }\n    i++;\n  }\n  return config as NormalizedConfig;\n};\n\ntype ResolvableToFn<T> = Extract<ResolvableTo<T>, (...args: any[]) => any>;\ntype ResolvableToParameters<T> = Parameters<ResolvableToFn<T>>;\ntype PluginUtils<T> = ResolvableToParameters<T>[0];\n\nexport const resolve = <T, U>(value: ResolvableTo<T>, callback: (resolvedValue: T) => U) =>\n  typeof value === 'function'\n    ? (utils: PluginUtils<T>) => callback((value as ResolvableToFn<T>)(utils))\n    : callback(value);\n\nexport const extend = <Theme extends NormalizedTheme>(\n  theme: Theme,\n  callback: (theme: Theme, isExtend: boolean) => unknown,\n  createExtendIfMissing = false\n) => {\n  callback(theme, false);\n  if (createExtendIfMissing) {\n    if (!theme.extend) theme.extend = createNormalizedThemeObject() as NormalizedTheme;\n  }\n  if (theme.extend) {\n    callback(theme.extend as Theme, true);\n  }\n};\n"],"names":["isTailwindPlugin","plugin","p","handler","hasTailwindHandler","isTurbinePlugin","transform","hasTurbineTransform","Array","isArray","plugins","every","hasTurbinePlugins","_ref","_step","i","config","_config","_config2","_config3","_config$theme","_config$theme$extend","_config$theme2","_config4","content","length","files","console","warn","_extends","_config$safelist","safelist","blocklist","presets","theme","supports","data","colors","spacing","container","extend","createNormalizedThemeObject","_config4$plugins","normalizeConfig","_iterator","_createForOfIteratorHelperLoose","done","value","push","Error","_config$plugins","_ref2","apply","filter","j","callback","createExtendIfMissing","utils"],"mappings":"8UAoBA,SAASA,EAAiBC,GACxB,IAAMC,EAAsB,mBAAXD,EAAwBA,EAAO,CAAE,GAAIA,EACtD,OAAOC,GALT,SAA4BD,GAC1B,MAAO,YAAaA,GAAoC,mBAAnBA,EAAOE,OAC9C,CAGcC,CAAmBF,EACjC,CASA,SAASG,EAAgBJ,GACvB,IAAMC,EAAsB,mBAAXD,EAAwBA,EAAO,CAAE,GAAIA,EACtD,OAAOC,IART,SAA6BD,GAC3B,MAAO,cAAeA,GAAsC,mBAArBA,EAAOK,SAChD,CAMeC,CAAoBL,IALnC,SAA2BD,GACzB,MAAO,YAAaA,GAAUO,MAAMC,QAAQR,EAAOS,UAAYT,EAAOS,QAAQC,MAAMX,EACtF,CAGyCY,CAAkBV,GAC3D,eAiEqB,SAAHW,GAWhB,QAA4BC,EAT5BJ,EAAOG,EAAPH,QAOIK,EAAI,EACJC,EAxCkB,SAACA,GAA8D,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EA0BrF,gBA1BuBP,IAAAA,EAAsC,CAAE,KAE5DA,EAAOQ,SACPhB,MAAMC,QAAQO,EAAOQ,UAAsC,IAA1BR,EAAOQ,QAAQC,SAC/CjB,MAAMC,QAAQO,EAAOQ,UAA4C,IAAhCR,EAAOQ,QAAQE,MAAMD,SAExDE,QAAQC,KACN,4JAGJZ,EAAOQ,QAAOK,EAAA,CACZH,MAAOlB,MAAMC,QAAQO,EAAOQ,SAAWR,EAAOQ,QAAU,IACpDR,EAAOQ,UAAYhB,MAAMC,QAAQO,EAAOQ,SAAWR,EAAOQ,QAAU,IAE3DM,OAAfb,EAAAD,GAAOe,WAAPd,EAAOc,SAAa,WACpBb,EAAAF,GAAOgB,YAAPd,EAAOc,UAAc,IACP,OAAdb,EAAAH,GAAOiB,UAAPd,EAAOc,QAAY,IACnBjB,EAAOkB,MAAKL,EAAA,CAAA,EAzB8C,CAC1DM,SAAU,CAAA,EACVC,KAAM,GACNC,OAAQ,CAAE,EACVC,QAAS,CAAA,EACTC,UAAW,WAqBuBnB,EAC5BJ,EAAOkB,OAAKd,EAAI,GAAE,CACtBoB,OAAMX,EACDY,CAAAA,EA7BmD,CAC1DN,SAAU,CAAA,EACVC,KAAM,GACNC,OAAQ,CAAE,EACVC,QAAS,CAAA,EACTC,UAAW,IAyBiB,OADQlB,EAC5BC,OAD4BA,EAC5BN,EAAOkB,YAAPZ,EAAAA,EAAckB,QAAMnB,EAAI,MAGlBqB,OAAdnB,EAAAP,GAAON,UAAPa,EAAOb,QAAY,IACZM,CACT,CAae2B,CATK9B,EAAlBG,QAUA4B,2qBAAAC,CAAqBnC,KAAOI,EAAA8B,KAAAE,MAAE,CAAnB,IAAA7C,EAAMa,EAAAiC,MACf,GAAI/C,EAAiBC,GACnBe,EAAON,QAAQsC,KAAK/C,YACXI,EAAgBJ,GAiBzB,MAAU,IAAAgD,MAA4ClC,sCAAAA,qDAhBtD,IAIamC,EAJbC,EAAiD,mBAAXlD,EAAwBA,IAAWA,EAAjEK,EAAS6C,EAAT7C,UAAWI,EAAOyC,EAAPzC,QACfJ,IACFU,EAASV,EAAUU,IAEjBN,IACFwC,EAAAlC,EAAON,SAAQsC,KAAII,MAAAF,EACdxC,EAAQ2C,OAAO,SAACpD,EAAQqD,GACzB,QAAItD,EAAiBC,KACrB0B,QAAQC,KAAI,iDACuC0B,EAAmCvC,kCAAAA,kBAGxF,EAAA,GAKN,CACAA,GACF,CACA,OAAOC,CACT,iBAWsB,SACpBkB,EACAqB,EACAC,QAAAA,IAAAA,IAAAA,GAAwB,GAExBD,EAASrB,GAAO,GACZsB,IACGtB,EAAMM,SAAQN,EAAMM,OA5F+B,CAC1DL,SAAU,CAAA,EACVC,KAAM,GACNC,OAAQ,CAAE,EACVC,QAAS,CAAA,EACTC,UAAW,MAyFPL,EAAMM,QACRe,EAASrB,EAAMM,QAAiB,EAEpC,kBAjBuB,SAAOO,EAAwBQ,SACnC,mBAAVR,EACH,SAACU,UAA0BF,EAAUR,EAA4BU,GAAO,EACxEF,EAASR,EAAM"}